<!DOCTYPE html>
<html>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
 <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" >

 <link rel="icon" type="image/vnd.microsoft.icon" href="../conemu.ico">

 <link rel="canonical" href="http://conemu.github.io" />

 <link rel="stylesheet" href="../main.css">

 <title>ConEmu - эмулятор терминала Windows</title>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-9200434-5', 'auto');
  ga('send', 'pageview');

</script>

</head>

<body>

<div class="wrapper">
<div class="maincol" id="wikimaincol">

	<div class="header">
		<div id="logo-block">
			<div>
				<h1><a href="http://conemu.github.io/ru/ConEmu.html">ConEmu</a></h1>
				<div id="logo-descr"><a href="http://conemu.github.io/ru/ConEmu.html">эмулятор терминала</a></div>
				<div id="social">
					<a href="http://www.facebook.com/share.php?u=http://conemu.github.io/" rel="nofollow" target="_blank" title="FaceBook" id="soc-facebook"></a>
					<a href="http://twitter.com/share?url=http://conemu.github.io/" rel="nofollow" target="_blank" title="Twitter" id="soc-twitter"></a>
					<div id="soc-plus">
						<div style="background: transparent; text-indent: 0px; margin: 0px; padding: 0px; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 124px; height: 26px;"
							id="___plusone_0"><iframe frameborder="0" hspace="0" marginheight="0" marginwidth="0" scrolling="no" style="background: transparent; position: static; top: 0px; width: 88px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 24px;" tabindex="0" vspace="0" width="100%"
							id="I0_1419983428828" name="I0_1419983428828" src="https://apis.google.com/u/0/se/0/_/+1/fastbutton?usegapi=1&amp;origin=http%3A%2F%2Fconemu.github.io&amp;url=http%3A%2F%2Fcode.google.com%2Fp%2Fconemu-maximus5%2F&amp;gsrc=3p&amp;ic=1&amp;jsh=m%3B%2F_%2Fscs%2Fapps-static%2F_%2Fjs%2Fk%3Doz.gapi.en.j1QholfdnmY.O%2Fm%3D__features__%2Fam%3DAQ%2Frt%3Dj%2Fd%3D1%2Ft%3Dzcms%2Frs%3DAGLTcCP1BSvtxoI3E2wzG7twjHbDrCUuHA#_methods=onPlusOne%2C_ready%2C_close%2C_open%2C_resizeMe%2C_renderstart%2Concircled%2Cdrefresh%2Cerefresh%2Conload&amp;id=I0_1419983428828&amp;parent=http%3A%2F%2Fconemu.github.io&amp;pfname=&amp;rpctoken=42383786" data-gapiattached="true"
							title="+1"></iframe></div>
					</div>
				</div>
			</div>
			<div style="overflow: hidden; width:728px; height:90px; position: relative; left: 210px; top: -90px;">
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
				<!-- conemu.github.io -->
				<ins class="adsbygoogle"
				     style="display:inline-block;width:728px;height:90px"
				     data-ad-client="ca-pub-8810818700876198"
				     data-ad-slot="5792850468"></ins>
				<script>
				(adsbygoogle = window.adsbygoogle || []).push({});
				</script>
			</div>
		</div>
		<div id="header-line"></div>
	</div><!-- .header-->

	<div class="middle">
		<div class="container">
			<div class="content">

<!-- Content starts -->

<!--
<i>The problem with apphelp.dll</i>
-->
<p><!-- https://bugs.php.net/bug.php?id=36055 https://bugzilla.mozilla.org/show_bug.cgi?id=939043 --> </p>
<h2 id="h0"><a name="Abstract"></a>Abstract<a href="#Abstract" class="section_anchor"></a></h2>
<p>Several times I&#x27;ve seen cygwin/msys errors when their subsystem had failed to create child processes. </p>
<h3><a name="Example_from_cygwin&#x27;s_ls"></a>Example from cygwin&#x27;s ls<a href="#Example_from_cygwin&#x27;s_ls" class="section_anchor"></a></h3>
<pre class="prettyprint">0 [main] us 0 init_cheap: VirtualAlloc pointer is null, Win32 error 487 AllocationBase 0x68520000, BaseAddress 0x68570000, RegionSize 0x218000, State 0x1000 C:\Program Files (x86)\Git\bin\ls.exe: *** Couldn&#x27;t reserve space for cygwin&#x27;s heap, Win32 error 487</pre>
<h3><a name="Example_from_msys-git&#x27;s_perl"></a>Example from msys-git&#x27;s perl<a href="#Example_from_msys-git&#x27;s_perl" class="section_anchor"></a></h3>
<pre class="prettyprint">C:\GIT\bin\perl.exe: *** unable to remap C:\GIT\bin\libsvn_wc-1-0.dll to same address as parent -- 0x2190000
1 [main] perl 8248 sync_with_child: child 5768(0xB60) died before initialization with status code 0x1
2 [main] perl 8248 sync_with_child: *** child state child loading dlls
C:\GIT\bin\perl.exe: *** unable to remap C:\GIT\lib\perl5\site_perl\5.8.8\msys\auto\SVN\_Delta\_Delta.dll to same address as parent -- 0x630000
3 [main] perl 8248 sync_with_child: child 6632(0xB90) died before initialization with status code 0x6802752F
3 [main] perl 8248 sync_with_child: *** child state child loading dlls</pre>
<h2><a name="The_problem"></a>The problem<a href="#The_problem" class="section_anchor"></a></h2>
<p>Digging the problem for some time I&#x27;ve found the reason of these errors on my PC (in perl&#x27;s case). </p>
<ul><li>Address, where perl wants to load its libraries was used by <tt>C:\Windows\System32\uxtheme.dll</tt>. </li><li>This <tt>uxtheme.dll</tt> was loaded as static linked library by <tt>C:\Windows\apppatch\AcGenral.dll</tt>. </li><li>This <tt>AcGenral.dll</tt> was loaded (dynamically) by <tt>C:\Windows\System32\apphelp.dll</tt>. </li><li>And this <tt>apphelp.dll</tt> was loaded in the parent process of the <tt>ConEmu.exe</tt> (that was <tt>USBSafelyRemove.exe</tt> in my case). </li><li>Oops... </li></ul><h2><a name="The_check"></a>The check<a href="#The_check" class="section_anchor"></a></h2>
<p><i>The following examples shows msysgit x86</i> </p>
<p>Almost all dll-s used by cygwin/msys must be loaded at high memory addresses (above 0x60000000). </p>
<p>For example, if you call </p>
<pre class="prettyprint">dumpbin /HEADERS C:\GIT\bin\libsvn_wc-1-0.dll</pre>
<p>You will see </p>
<pre class="prettyprint">OPTIONAL HEADER VALUES
        6F1C0000 image base (6F1C0000 to 6F2E7FFF)</pre>
<p>So, you you see that one of the cygwin/msys libraries is loaded in low memory address (below 0x5FFF0000) you have a problem most probably... The easies way to check is using <a href="ProcessExplorer.html">ProcessExplorer</a>. </p>
<p>Press <tt>Ctrl+D</tt> (Menu <tt>-&gt;</tt> View <tt>-&gt;</tt> Lower pane view <tt>-&gt;</tt> DLLs) and look at ‘Base’ column in the lower pane. If it is not visible just right-click on the DLLs list header, choose ‘Select columns’ and turn on ‘Base address’ on the ‘DLL’ tab page. And use ‘dumpbin’ to ensure that required ‘image base’ differs. </p>
<p>Scroll the DLLs list in the <a href="ProcessExplorer.html">ProcessExplorer</a> lower pane to find ‘Base+Size’ which covers desired address was shown by ‘dumpbin’. And who was loaded that dll? You may use <a href="DependencyWalker.html">DependencyWalker</a> or <a href="ImpEx.html">ImpEx</a> to check ‘Imports’ section of each dll loaded before. Yeah, that is not too simple but rather... </p>
<h2><a name="The_solution"></a>The solution<a href="#The_solution" class="section_anchor"></a></h2>
<p>1) You need to ‘rebase’ conflicting modules. </p>
<p>2) Alternatively you need to run your shell in different way so process tree will not include DLLs raised the conflict. In my case, when I run ConEmu from TaskBar icon there is no <tt>apphelp.dll</tt> in the result process tree (from <tt>ConEmu.exe</tt> down to <tt>perl.exe</tt>). But when I run ConEmu from ‘USB Safe Remove’ tool (automatically on connecting USB flash), <tt>apphelp.dll</tt> appears in the process tree and perl is always failed... </p>

<!-- Content ends -->

			</div><!-- .content-->
		</div><!-- .container-->

		<div class="left-sidebar">
			<div class="block">
				<div class="blocktitle">Меню сайта</div>
				<div class="blockcontent">
					<ul>
					<!-- Menu starts -->
					<!-- Add ' class="MenuItemA" ' to current <a> item -->
					<li><a href="../index.html"><span>На главную</span></a></li>
					<li><a href="http://www.fosshub.com/ConEmu.html"><span>Скачать</span></a></li>
					<li><a class="MenuItemA" href="./TableOfContents.html"><span>Документация</span></a></li>
					<li><a href="./Screenshots.html"><span>Скриншоты</span></a></li>
					<li><a href="./Settings.html"><span>Настройка</span></a></li>
					<li><a href="../auto.html"><span>Автоматизация</span></a></li>
					<li><a href="../donate.html"><span>Поддержать</span></a></li>
					<li><a href="./AnsiEscapeCodes.html"><span>ANSI</span></a></li>
					<li><a href="./Awards.html"><span>Awards</span></a></li>
					<li><a href="./Delusions.html"><span>Заблуждения</span></a></li>
					<li><a href="./Source.html"><span>Исходный код</span></a></li>
					<!-- Menu ends -->
					</ul>
				</div>
				<div class="blockbottom"></div>
			</div>
		</div><!-- .left-sidebar -->

	</div><!-- .middle-->

</div><!-- maincol -->
</div>

<div class="footer">
	<div id="footertext">Copyright Maximus5 © 2015</div>
</div><!-- .footer -->

</body>
</html>

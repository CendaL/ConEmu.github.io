<!DOCTYPE html>
<html>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
 <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" >

 <link rel="icon" type="image/vnd.microsoft.icon" href="../conemu.ico">

 <link rel="canonical" href="http://conemu.github.io" />

 <link rel="stylesheet" href="../main.css">

 <title>ConEmu - эмулятор терминала Windows</title>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-9200434-5', 'auto');
  ga('send', 'pageview');

</script>

</head>

<body>

<div class="wrapper">
<div class="maincol" id="wikimaincol">

	<div class="header">
		<div id="logo-block">
			<div>
				<h1><a href="http://conemu.github.io/ru/ConEmu.html">ConEmu</a></h1>
				<div id="logo-descr"><a href="http://conemu.github.io/ru/ConEmu.html">эмулятор терминала</a></div>
				<div id="social">
					<a href="http://www.facebook.com/share.php?u=http://conemu.github.io/" rel="nofollow" target="_blank" title="FaceBook" id="soc-facebook"></a>
					<a href="http://twitter.com/share?url=http://conemu.github.io/" rel="nofollow" target="_blank" title="Twitter" id="soc-twitter"></a>
					<div id="soc-plus">
						<div style="background: transparent; text-indent: 0px; margin: 0px; padding: 0px; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 124px; height: 26px;"
							id="___plusone_0"><iframe frameborder="0" hspace="0" marginheight="0" marginwidth="0" scrolling="no" style="background: transparent; position: static; top: 0px; width: 88px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 24px;" tabindex="0" vspace="0" width="100%"
							id="I0_1419983428828" name="I0_1419983428828" src="https://apis.google.com/u/0/se/0/_/+1/fastbutton?usegapi=1&amp;origin=http%3A%2F%2Fconemu.github.io&amp;url=http%3A%2F%2Fcode.google.com%2Fp%2Fconemu-maximus5%2F&amp;gsrc=3p&amp;ic=1&amp;jsh=m%3B%2F_%2Fscs%2Fapps-static%2F_%2Fjs%2Fk%3Doz.gapi.en.j1QholfdnmY.O%2Fm%3D__features__%2Fam%3DAQ%2Frt%3Dj%2Fd%3D1%2Ft%3Dzcms%2Frs%3DAGLTcCP1BSvtxoI3E2wzG7twjHbDrCUuHA#_methods=onPlusOne%2C_ready%2C_close%2C_open%2C_resizeMe%2C_renderstart%2Concircled%2Cdrefresh%2Cerefresh%2Conload&amp;id=I0_1419983428828&amp;parent=http%3A%2F%2Fconemu.github.io&amp;pfname=&amp;rpctoken=42383786" data-gapiattached="true"
							title="+1"></iframe></div>
					</div>
				</div>
			</div>
			<div style="overflow: hidden; width:728px; height:90px; position: relative; left: 210px; top: -90px;">
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
				<!-- conemu.github.io -->
				<ins class="adsbygoogle"
				     style="display:inline-block;width:728px;height:90px"
				     data-ad-client="ca-pub-8810818700876198"
				     data-ad-slot="5792850468"></ins>
				<script>
				(adsbygoogle = window.adsbygoogle || []).push({});
				</script>
			</div>
		</div>
		<div id="header-line"></div>
	</div><!-- .header-->

	<div class="middle">
		<div class="container">
			<div class="content">

<!-- Content starts -->

<p>Injects? ConEmuHk.dll? All spawned processes in ConEmu consoles? Yes! </p>
<p>There are a lot of information exists in wiki already but let it be here, in one place. </p>
<p>ConEmu need to intercept large amount of Windows API functions, otherwise it is not possible neither to avoid certain <a href="MicrosoftBugs.html">MicrosoftBugs</a> nor implement much of juicy features. </p>
<p>One may said, other terminals works without injects perfectly... But that is not true. For example, mintty is small, fast and works without injects, but you can&#x27;t run there many programs (PowerShell, Far Manager and many others using Windows console API). Another well known terminal Console and its clones (it uses injects)  will have same problems as ConEmu (for example, <a title="assertion dialogs launched from hidden console window are inaccessible" class=closed_ref href="http://code.google.com/p/conemu-maximus5/issues/detail?id=643">&nbsp;Issue 643&nbsp;</a> or <a title="ConEmu.Maximus5.090725.7z - неработает Telnet.exe" class=closed_ref href="http://code.google.com/p/conemu-maximus5/issues/detail?id=65">&nbsp;Issue 65&nbsp;</a>). </p>
<h2 id="h0"><a name="Tech_info"></a>Tech info<a href="#Tech_info" class="section_anchor"></a></h2>
<p>What are injects? <a href="ConEmu.html">ConEmu</a> provides two dlls ConEmuHk.dll and ConEmuHk64.dll which will be loaded in each process of console processes started in ConEmu window. Injections may be possible with SetThreadContext after CreateProcess. When dll is loaded into target process it may hook Windows API (in that process only) changing IAT pointers. </p>
<h2><a name="Slowdown"></a>Slowdown<a href="#Slowdown" class="section_anchor"></a></h2>
<p>Current method of injections and hooking will cause small lag when new process is created in the ConEmu console. It is really small (about 60 ms per process on my virtual PC). User may notice that lag in the only case of running hundreds and thousands of processes. </p>
<h2><a name="Third_party_problems"></a>Third party problems<a href="#Third_party_problems" class="section_anchor"></a></h2>
<p>I had bunches of issues about ‘crashes in ConEmu’. Really? And what are the causes? </p>
<ul><li><a href="MicrosoftBugs.html">MicrosoftBugs</a>. Windows kernel has several bugs leading to crashes, hungs and black screens. Microsoft fix bugs in next windows versions only. Great, user needs to buy new Windows... Workaround? Injects only. </li>
<li>Third party tools run injects too. Several injection systems will conflict each other. The result? Crash! One system tries to execute LoadLibrary in the external process, but it think that LoadLibrary is located in the other module than kernel32.dll. Sadly. </li><ul><li>MacType and sort of. There is workaround - add ConEmuC.exe and ConEmuC64.exe to MacType exclusion list. You may still use it with ConEmu.exe and ConEmu64.exe. </li>
<li>AnsiCon. Another ANSI sequences processor. <a href="ConEmu.html">ConEmu</a> already implements that feature internally. </li>
<li>Intel pin. You may use it with wrapper batch file, disabling ConEmuHk temporarily. Read about <a href="ConEmuEnvironment.html">ConEmuHooks environment variable</a>. </li></ul><li>ConEmu bugs. Hmm, show me completely bugless software? Report the problem and it will be fixed, I hope. </li></ul><h2><a name="Conclusion"></a>Conclusion<a href="#Conclusion" class="section_anchor"></a></h2>
<p>Do you think still you have no need in ConEmuHk? Well, you may <strong>completely</strong> disable them, but <strong>don&#x27;t complain</strong> of arisen problems which are absent when injects are enabled. </p>
<ul><li>Uncheck ‘Inject ConEmuHk’ </li>
<li>Physically delete files ConEmuHk.dll and ConEmuHk64.dll. </li></ul><p>At last, I have some plans about rewritting hooks code using different technique. But it will take time and I can&#x27;t predict what speed improvement can be achieved. </p>

<!-- Content ends -->

<!-- BackToContents start -->
				<div class="text stext"><a href="./TableOfContents.html">Назад к оглавлению</a></div>
<!-- BackToContents end -->

			</div><!-- .content-->
		</div><!-- .container-->

		<div class="left-sidebar">
			<div class="block">
				<div class="blocktitle">Меню сайта</div>
				<div class="blockcontent">
					<ul>
					<!-- Menu starts -->
					<!-- Add ' class="MenuItemA" ' to current <a> item -->
					<li><a href="../index.html"><span>На главную</span></a></li>
					<li><a href="http://www.fosshub.com/ConEmu.html"><span>Скачать</span></a></li>
					<li><a class="MenuItemA" href="./TableOfContents.html"><span>Документация</span></a></li>
					<li><a href="./Screenshots.html"><span>Скриншоты</span></a></li>
					<li><a href="./Settings.html"><span>Настройка</span></a></li>
					<li><a href="../auto.html"><span>Автоматизация</span></a></li>
					<li><a href="../donate.html"><span>Поддержать</span></a></li>
					<li><a href="./AnsiEscapeCodes.html"><span>ANSI</span></a></li>
					<li><a href="./Awards.html"><span>Awards</span></a></li>
					<li><a href="./Delusions.html"><span>Заблуждения</span></a></li>
					<li><a href="./Source.html"><span>Исходный код</span></a></li>
					<!-- Menu ends -->
					</ul>
				</div>
				<div class="blockbottom"></div>
			</div>
		</div><!-- .left-sidebar -->

	</div><!-- .middle-->

</div><!-- maincol -->
</div>

<div class="footer">
	<div id="footertext">Copyright Maximus5 © 2015</div>
</div><!-- .footer -->

</body>
</html>
